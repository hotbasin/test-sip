# Тестовое задание по Backend-разработке сервиса IP-телефонии #

## Содержание ##

[1. Условия задания](#условия-задания)    
[2. Описание решения](#описание-решения)    
[3. Результат](#результат)    
[4. Инструкция по запуску проекта](#инструкция-по-запуску-проекта)    

## Условия задания ##

Разработать бэкенд сервиса, осуществляющего автоматический дозвон до загружаемой
пользователем базы абонентов и воспроизводящий при дозвоне загруженный звуковой
файл.

У пользователя должна быть возможность задать параметры подключения к поставщику
телефонии (адрес sip шлюза, имя пользователя, пароль, etc.), загрузить звуковой
файл, загрузить базу абонентов (список телефонных номеров) и инициировать дозвон
до базы абонентов с воспроизведение загруженного звукового файла.

Требования к сервису:

1. Аутентификация OAuth 2.0 с идентификацией по логину/паролю
2. Авторизация запроса токеном в заголовке
3. RESTfull API + swagger для тестирования
4. Реализация телефонного дозвона без привлечения сторонних сервисов.

[:arrow_up: Содержание](#содержание)

----

## Описание решения ##

- Для запуска и демонстрации работы API принято решение использовать простой
web-сервер **Bottle** и СУБД **SQLite3** вместо **Django** и **PostgreSQL**,
чтобы не утяжелять проверку и уложиться в сроки.

- Валидация входных данных, кроме access-токена не проводится.

- База данных **SQLite3** содержит две таблицы. В таблице **`Users`** хранятся
пользовательские данные, в таблице **`Callbase`**&nbsp;&mdash; база абонентов.

### Таблица Users ###

    uid         VARCHAR(36)     (PRIMARY KEY) в формате uuid4
    name        VARCHAR(1024)   Имя
    login       VARCHAR(1024)   Логин
    password    VARCHAR(1024)   Пароль
    acc_token   VARCHAR(1024)   Access-токен с ограниченным временем действия
    expired     FLOAT           Дата окончания лействия access-токена в UNIX-формате
    comment     TEXT(1024)      Дополнительная информация

### Таблица Callbase ###

    cid         VARCHAR(36)     (PRIMARY KEY) в формате uuid4
    name        VARCHAR(1024)   Имя
    number      VARCHAR(12)     Номер телефона
    comment     TEXT(1024)      Дополнительная информация

- При желании можно расширить функционал применением refresh-токена, который
должен запрашиваться при истечении срока действия access-токена, но пока от
этого отказались. Таким образом при просроченном access-токене надо заново
логиниться на сервере и получать новый access-токен (ещё на 10&nbsp;минут).

[:arrow_up: Содержание](#содержание)

----

## Результат ##

- JWT_KEY должна быть одинаковой в api_srv.py и в api_client.py для упаковки и
распаковки JSON Web Token.

[:arrow_up: Содержание](#содержание)

----

## Инструкция по запуску проекта ##

1. На компьютере должен быть установлен **Python** версии **3.8** или более
поздней и соответствующий пакетный менеджер **pip**.
2. Установить **SQLite3** (можно по руководствам
[для Linux](https://linoxide.com/install-use-sqlite-linux) или
[для Windows](https://www.sqlitetutorial.net/download-install-sqlite/)).
3. Скачать файлы проекта из текущей директории репозитория в локальную
директорию компьютера.
4. Для создания файла БД `sqlite/db.sqlite3` войти в поддиректорию `sqlite`,
запустить **SQLite** и потом ввести мета-команды:

    ```bash
    # Запуск
    sqlite3 db.sqlite3

    # Мета-команды
    .read db.sql
    .exit
    ```

5. Примерная последовательность команд в консоли терминала для запуска проекта
в виртуальном окружении `virtualenv` в локальной директории:

    ```bash
    python -m venv VENV

    # для ОС Linux:
    source VENV/bin/activate
    # для ОС Windows:
    VENV\Scripts\activate

    pip install -r requirements.txt

    python main.py
    # Выход по Ctrl+C

    # Выход из виртуального окружения
    # для ОС Linux:
    deactivate
    # для ОС Windows:
    VENV\Scripts\deactivate.bat
    ```

[:arrow_up: Содержание](#содержание)

----
